{% set currency = app.user.currentMember.tgroup.currency.symbol %}

<div class="row">
	<div class="span4">
		{% include "TkExpenseBundle:Payback:addPaybackModal.html.twig" %}
		<div id="settlement" class="flat-container">
			<div class="expense-header flat-header" style="text-align:left;">
				<div id="expense-title">
					<h2>PAYBACK</h2>
				</div>
				<a href="#addPaybackModal" role="button" data-toggle="modal">
					<div id="add-expense-btn">
						<i class="icon-plus-sign" style=""></i>ADD PAYBACK
					</div>
				</a>
			</div>
			{% if debts|length == 0 %}
			<p style="margin-top: 10px; color:rgb(67,113,191)">No debts at all, lucky you !</p>
			{% else %}

			<div class="payback-table">
				<table>
					{% for debt in debts %}
					<tr style="height: 30px;">
						<td style="text-align: left;">{{ debt[0] }}</td> 
						<td class="payback-text">gives </td>
						<td style="color:#99B335;">{{ debt[1] }} {{ currency }}</td>
						<td class="payback-text"> to </td>
						<td style="text-align: left;">{{ debt[2] }}</td>
					</tr>
					{% endfor %}

				</table>
			</div>

			{% endif %}
		</div>
		<div id="balance" class="flat-container">
			<div class="expense-header flat-header">
				<div id="expense-title">
					<h2>BALANCE</h2>
				</div>
			</div>
			<div>
				<div id="balance-slimscroll" style="text-align:center; margin-top: 20px; width:90%; margin: 0px auto; padding-top: 10px;; margin-bottom: 15px">
					<canvas id="balanceChart" width="500px" height="150px"></canvas>
					<table id="chart-labels" style="margin-top:-30px; margin-left:auto; margin-right:auto;table-layout: fixed; margin-bottom: 5px">
						<tr id="balance-row">
							{% for member in app.user.currentMember.tgroup.members %}
							<td style='width:70px; min-width:70px; color:{% if member.balance >= 0 %}#A8BD44{% else %}#F97E76{% endif %}; vertical-align:top;overflow: hidden; padding:0'>{{ member.name }}</td>	
							{% endfor %}	
						</tr>
						<tr id="member-row">
							{% for member in app.user.currentMember.tgroup.members %}
							<td style='width:70px; min-width:70px; color:{% if member.balance >= 0 %}#A8BD44{% else %}#F97E76{% endif %}; vertical-align:top;overflow: hidden; padding:0; border: none'>{{ member.balance }}{{ member.tgroup.currency.symbol }}</td>
							{% endfor %}
						</tr>
					</table>						
				</div>
			</div>
		</div>
	</div>		
	<div class="span8" >
		<div id="timeline" style="position: relative">
			<img src="{{ asset('img/Frame/group-icon-pointer.png') }}" class="img-circle" width="50px" style="position:absolute; top: -5px; left:2px" alt="profile picture">
		</div>
		<div id="timeline-expense-container">
			{% include "TkExpenseBundle:Expense:addExpenseModal.html.twig" %}
			<div class="expense-list flat-container">
				<div class="expense-header flat-header">
					<div id="expense-title">
						<h2>EXPENSE TIMELINE</h2>
					</div>
					<a href="#addExpenseModal" role="button" data-toggle="modal">
						<div id="add-expense-btn">
							<i class="icon-plus-sign" style=""></i>ADD EXPENSE
						</div>
					</a>
				</div>
				<div id="filter-buttons">
					<a id="show-all-button" class="active">show all</a>
					<a id="only-mine-button">only mine</a>
				</div>
				<div id="expense-summary">
					You paid {{ total_paid_by_me }}{{ currency }} -
					{% if total_balance >= 0 %}
					You get {{ total_balance }}{{ currency }}	
					{% else %}
					You owe {{ -total_balance}}{{ currency }}	
					{% endif %} 
				</div>		
			</div>


			<!-- ---------------------------------------->
			{% if all_expenses|length == 0 %}
			<div class="pinpoint-tmln" style="margin-left: -7.55%">
				<a  href="#" data-toggle="tooltip" rel="tooltip" title="" >
					<img class="pinpoint-button" src="{{ asset('img/Frame/tmln-btn.png') }}" class="img-circle" width="20px">
				</a>
			</div>
			<div class="expense-list flat-container" style="text-align: center">
				<div class="no-expense">
					<p>There is no expense here yet</p></div>
					<a href="#addExpenseModal" role="button" data-toggle="modal" class="flat-btn flat-pk flat-large" style="background-color: rgb(67,113,191); color:rgb(229,240,255) ; height:25px; padding-top: 5px">Add an expense</a>
				</div>

				{% else %}

				<div class="accordion" id="accordion2">
					{% set date = true %}
					{% set previous = null %}

					<div id="expense-table-container" class="flat-container">
						<table id="expense-table">
								<thead id="expense-table-header">
									<tr>
									<td style="text-align: center;">Who</td>
									<td>How Much</td>
									<td>What</td>
									<td style="text-align: center;">Your Share</td>
									<td></td>
									</tr>
								</thead>
								<tbody>
							{% for expense in all_expenses %}
							<div class="expense-block {% if expense[1] == 0 and expense[0].owner != app.user.currentMember %}nottagged{% endif %}">
								{% set previous = expense[0].date %}
									<tr class="expense-row">
										<td id="profile-pic-row">
											<div style="margin-top:4px">
												<font style="color:#fb786b">
													{% if expense[0].owner.user == app.user %}
													You
													{% else %}
													{{ expense[0].owner.name }} 
													{% endif %}
												</font>
											</div>
											<div>
												{% if expense[0].owner.user %}
												{% if expense[0].owner.user.facebookId %}
												<img src="http://graph.facebook.com/{{expense[0].owner.user.facebookId}}/picture?width=60&height=60" class="img-circle" width="30px" alt="Payer picture" style="position: relative">
												{% else %}
												<img src="{{ asset(expense[0].owner.user.picture.path) }}" class="img-circle" width="30px" alt="Payer picture" style="position: relative">
												{% endif %}
												{% else %}
												<img src="{{ asset('uploads/profile-pictures/profile-pic.png') }}" class="img-circle" width="30px" 	alt="Payer picture" style="position: relative">
												{% endif %}
											</div>
										</td>
										<td id="amount-column">
											<font style="color:#0088CC;">
												{{ expense[0].amount }} {{ currency }}
											</font> 
										</td>
										<td> 
											<div>
												<font style="color:#fb786b;">
													{{ expense[0].name }}
												</font>
											</div>
											<div>
												<p style="margin-bottom:0px;"><font style="color:rgb(140,140,140)">For who: </font> {% for member in expense[0].users %}{{ member.name }},  {% endfor %}</p>
											</div> 
										</td>
										<td id="balance-column">
											{% if expense[0].owner.user == app.user %}
											<font style="color:rgba(69,69,69,0.6);">
												YOU GET<br>
											</font>
											<font style="color:rgb(153,179,53); font-weight: bold">
												{{ expense[1] }} {{ currency }}
											</font>
											{% else %}
											<font style="color:rgba(69,69,69,0.6);">
												YOU OWE<br>
											</font>
											<font style="color:#fb786b; font-weight: bold">
												{{ -expense[1] }} {{ currency }}
											</font>
											{% endif %}
										</td>
										<td id="edit-column">
											<div id="expense-edit-{{expense[0].id}}">
												<a class="edit-button" data-id="{{expense[0].id }}"><i class="icon-edit"></i></a>
												<a class="remove-button" href="{{ path('tk_expense_remove', {'id' : expense[0].id } ) }}"><i class="icon-trash"></i></a>
											</div>
										</td>
									</tr>
							</div>
							{% endfor %}
								</tbody>
						</table>

					</div>
				</div>





				{% endif %}
				<!-- ---------------------------------------->



			</div>
		</div>
	</div>	
</div>